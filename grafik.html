<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ì—Ä–∞—Ñ—ñ–∫ —á–µ—Ä–≥—É–≤–∞–Ω–Ω—è 48/24</title>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 10px;
  padding-bottom: 90px; /* –º—ñ—Å—Ü–µ –ø—ñ–¥ –Ω–∏–∂–Ω—é –ø–∞–Ω–µ–ª—å */
}

select, input, button {
  margin: 6px 0;
  width: 100%;
  padding: 8px;
  font-size: 16px;
}

h3 { margin-top: 0; }

.legend span {
  padding: 4px 8px;
  margin-right: 6px;
  border-radius: 4px;
  display:inline-block;
  font-size: 13px;
}

.on { background:#7ec8ff; }
.off { background:#7dff9a; }
.patrol { background:#ffb3b3; font-weight:bold; color:#900; }

.error {
  color:#b00020;
  font-weight:bold;
  margin:8px 0;
}

table {
  border-collapse: collapse;
  font-size: 14px;
  min-width: 100%;
}

th, td {
  border: 1px solid #999;
  padding: 8px;
  text-align: center;
}

th {
  background:#f0f0f0;
  position: sticky;
  top: 0;
  z-index: 4;
}

#tableContainer {
  max-height: 65vh;
  overflow: auto;
  border: 1px solid #999;
  margin-top: 10px;
}

/* ===================== */
/* üì± –°–ú–ê–†–¢–§–û–ù */
body.mobile {
  font-size: 13px;
}

body.mobile h3 {
  font-size: 16px;
  text-align: center;
}

body.mobile table {
  font-size: 12px;
}

body.mobile th,
body.mobile td {
  padding: 4px;
  min-width: 90px;
}

body.mobile th:first-child,
body.mobile td:first-child {
  position: sticky;
  left: 0;
  background: #f8f8f8;
  z-index: 5;
  min-width: 120px;
}

/* ===================== */
/* üì≤ –ü–õ–ê–ù–®–ï–¢ */
body.tablet table {
  font-size: 13px;
}

/* ===================== */
/* üîò –ù–∏–∂–Ω—è –ø–∞–Ω–µ–ª—å */
.bottom-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #f0f0f0;
  border-top: 1px solid #999;
  display: flex;
  gap: 6px;
  padding: 8px;
  z-index: 10;
}

.bottom-bar button {
  flex: 1;
  font-size: 15px;
  padding: 10px;
}
</style>
</head>

<body>

<h3>–ì—Ä–∞—Ñ—ñ–∫ —á–µ—Ä–≥—É–≤–∞–Ω–Ω—è –µ–∫—ñ–ø–∞–∂—É (48/24)</h3>

<div class="legend">
  <span class="on">–ß–µ—Ä–≥—É–≤–∞–Ω–Ω—è</span>
  <span class="off">–í—ñ–¥–ø–æ—á–∏–Ω–æ–∫</span>
  <span class="patrol">–î–û–ó–û–†</span>
</div>

<div id="errorBox" class="error"></div>

<label>–ß–∞—Å –ø–æ—á–∞—Ç–∫—É —á–µ—Ä–≥—É–≤–∞–Ω–Ω—è (–¥–ª—è –≤—Å—ñ—Ö)</label>
<select id="startTime">
  <option value="">‚Äî –æ–±–µ—Ä—ñ—Ç—å ‚Äî</option>
  <option value="6">06:00</option>
  <option value="18">18:00</option>
</select>

<label>–ú—ñ—Å—è—Ü—å —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É</label>
<select id="calcMonth"></select>

<label>–î–∞—Ç–∞ –ø–µ—Ä—à–æ–≥–æ –î–û–ó–û–†–£</label>
<input id="patrolDate" type="date">

<label>–ß–∞—Å –ø–æ—á–∞—Ç–∫—É –î–û–ó–û–†–£</label>
<select id="patrolTime">
  <option value="">‚Äî –æ–±–µ—Ä—ñ—Ç—å ‚Äî</option>
  <option value="6">06:00</option>
  <option value="18">18:00</option>
</select>

<hr>

<label>–ß–ª–µ–Ω –µ–∫—ñ–ø–∞–∂—É 1</label>
<input id="n1"><input id="d1" type="date">

<label>–ß–ª–µ–Ω –µ–∫—ñ–ø–∞–∂—É 2</label>
<input id="n2"><input id="d2" type="date">

<label>–ß–ª–µ–Ω –µ–∫—ñ–ø–∞–∂—É 3</label>
<input id="n3"><input id="d3" type="date">

<div id="tableContainer"></div>

<!-- üîò –ù–∏–∂–Ω—è –ø–∞–Ω–µ–ª—å -->
<div class="bottom-bar">
  <button onclick="build()">–ü–æ–±—É–¥—É–≤–∞—Ç–∏</button>
  <button onclick="shareTable()">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è</button>
  <button onclick="goMenu()">–ú–µ–Ω—é</button>
</div>

<script>
/* üì± –ê–≤—Ç–æ–≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—é */
(function(){
  const w = window.innerWidth;
  if (w <= 600) document.body.classList.add('mobile');
  else if (w <= 1024) document.body.classList.add('tablet');
})();

const SHIFT_ON = 48;
const SHIFT_OFF = 24;
const STEP = 12;

/* –ú—ñ—Å—è—Ü—ñ */
(function(){
  const y = new Date().getFullYear();
  for(let i=0;i<12;i++){
    const o=document.createElement('option');
    o.value=`${i}-${y}`;
    o.text=String(i+1).padStart(2,'0')+'-'+y;
    calcMonth.appendChild(o);
  }
})();

const fields=['startTime','calcMonth','patrolDate','patrolTime','n1','d1','n2','d2','n3','d3'];
fields.forEach(id=>{
  const el=document.getElementById(id);
  if(localStorage[id]) el.value=localStorage[id];
  el.onchange=()=>localStorage[id]=el.value;
});

function showError(m){ errorBox.textContent=m }
function clearError(){ errorBox.textContent='' }

function build(){
  clearError();
  if(!startTime.value||!calcMonth.value||!patrolDate.value||!patrolTime.value)
    return showError('‚ùó –ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –æ–±–æ–≤ º—è–∑–∫–æ–≤—ñ –ø–æ–ª—è');

  const [month,year]=calcMonth.value.split('-').map(Number);
  const crew=[
    {n:n1.value,d:new Date(d1.value),h:0},
    {n:n2.value,d:new Date(d2.value),h:0},
    {n:n3.value,d:new Date(d3.value),h:0}
  ];
  crew.forEach(c=>c.d.setHours(startTime.value,0,0,0));

  const mStart=new Date(year,month,1,startTime.value);
  const mEnd=new Date(year,month+1,1,startTime.value);

  let pStart=new Date(patrolDate.value);
  pStart.setHours(patrolTime.value,0,0,0);

  let html='<table><tr><th>–ü–µ—Ä—ñ–æ–¥ (12 –≥–æ–¥)</th>';
  crew.forEach(c=>html+=`<th>${c.n}</th>`);
  html+='</tr>';

  for(let t=new Date(mStart);t<mEnd;t.setHours(t.getHours()+12)){
    let to=new Date(t.getTime()+43200000);
    html+=`<tr><td>${t.toLocaleString('uk-UA')}<br>‚Äî<br>${to.toLocaleString('uk-UA')}</td>`;

    const patrol=((t-pStart)/3600000%96+96)%96<24;

    crew.forEach(c=>{
      let cyc=((t-c.d)/3600000%72+72)%72;
      if(cyc<48){
        c.h+=12;
        html+=patrol?'<td class="patrol">–î–û–ó–û–†</td>':'<td class="on">–ß–µ—Ä–≥—É–≤–∞–Ω–Ω—è</td>';
      } else html+='<td class="off">–í—ñ–¥–ø–æ—á–∏–Ω–æ–∫</td>';
    });
    html+='</tr>';
  }

  html+='<tr><th>–†–∞–∑–æ–º –≥–æ–¥–∏–Ω</th>';
  crew.forEach(c=>html+=`<th>${c.h}</th>`);
  html+='</tr></table>';

  tableContainer.innerHTML=html;
}

async function shareTable(){
  if(!tableContainer.innerHTML) return showError('‚ùó –°–ø–æ—á–∞—Ç–∫—É –ø–æ–±—É–¥—É–π—Ç–µ –≥—Ä–∞—Ñ—ñ–∫');
  const file=new File(
    [`<!DOCTYPE html><html><head>${document.head.innerHTML}</head>
      <body class="${document.body.className}">${tableContainer.innerHTML}</body></html>`],
    'grafik.html',
    {type:'text/html'}
  );
  if(navigator.canShare({files:[file]}))
    navigator.share({files:[file]});
  else alert('–ü–µ—Ä–µ–¥–∞—á–∞ –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è');
}

function goMenu(){
  window.location.href='./index.html';
}
</script>

</body>
</html>
