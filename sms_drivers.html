<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Калькулятор витрат палива — Командирський</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #1c1c1c;
        color: #e0e0e0;
    }

    .calculator {
        max-width: 600px;
        margin: 20px auto;
        padding: 15px;
    }

    .field-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #2f3e2f;
        border-radius: 12px;
        padding: 8px 12px;
        margin-bottom: 10px;
        box-shadow: 0 3px 6px rgba(0,0,0,0.5);
        flex-wrap: wrap;
    }

    .field-row label {
        flex: 1;
        font-size: 18px;
        color: #b8d2a3;
        margin-right: 10px;
        min-width: 120px;
    }

    .field-row input[type="text"],
    .field-row input[type="number"],
    .field-row input[type="date"] {
        flex: 1;
        max-width: 50%;
        padding: 8px;
        font-size: 18px;
        border-radius: 8px;
        border: 1px solid #555;
        background-color: #1e1e1e;
        color: #fff;
    }

    .field-row input::placeholder {
        color: #888;
    }

    .error-star {
        color: red;
        margin-left: 4px;
    }

    .buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 15px;
        flex-wrap: wrap;
        gap: 8px;
    }

    button {
        flex: 1;
        padding: 12px;
        font-size: 18px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        color: #fff;
        background: linear-gradient(145deg, #4a5b3a, #7fa34a);
        box-shadow: 2px 2px 6px rgba(0,0,0,0.7);
        transition: 0.2s;
        min-width: 100px;
    }

    button:hover {
        transform: translateY(-2px);
        box-shadow: 4px 4px 8px rgba(0,0,0,0.8);
    }

    #resultv {
        margin-top: 20px;
        font-size: 18px;
        word-break: break-word;
        color: #d1e8b2;
        text-align: center;
    }

    @media (max-width: 480px) {
        .field-row label {
            font-size: 16px;
            min-width: 100px;
        }
        .field-row input {
            font-size: 16px;
            max-width: 50%;
            padding: 8px;
        }
        button {
            font-size: 16px;
            padding: 10px;
        }
    }
</style>
</head>
<body>
<div class="calculator">
<h1 style="text-align:center; color:#b8d2a3;">Калькулятор витрат палива</h1>

<div class="field-row">
    <label>Виберіть дату</label>
    <input type="date" id="date">
</div>

<div class="field-row">
    <label id="crewLabel">Номер екіпажу</label>
    <input type="text" id="crewNumber" placeholder="Введіть номер екіпажу">
</div>

<div class="field-row">
    <label id="prevFuelLabel">Залишок палива</label>
    <input type="number" id="previousFuel" placeholder="л">
</div>

<div class="field-row">
    <label id="fuelRecLabel">Приход палива</label>
    <input type="number" id="fuelReceived" placeholder="Введіть приход палива" value="0" class="mt-4 block w-full rounded-md bg-gray-100 border-transparent focus:border-gray-500 focus:bg-white focus:ring-0">
  </div>

<div class="field-row">
    <label id="startLabel">Спідометр попередній</label>
    <input type="number" id="startSpeedometer" placeholder="км">
</div>

<div class="field-row">
    <label id="endLabel">Кінцевий спідометр</label>
    <input type="number" id="endSpeedometer" placeholder="км">
</div>

<div class="field-row">
    <label id="highwayLabel">Колона +10%</label>
    <input type="number" id="highwayLabel" placeholder="Введіть приход палива" value="0" class="mt-4 block w-full rounded-md bg-gray-100 border-transparent focus:border-gray-500 focus:bg-white focus:ring-0">
  </div>
 
<div class="field-row">
    <label id="streetLabel">Траса -15%</label>
    <input type="number" id="streetDistance" placeholder="км">
</div>

<div class="field-row">
    <label id="offroadLabel">Бездоріжжя +30%</label>
    <input type="number" id="offroadDistance" placeholder="км">
</div>

<div class="buttons">
    <button onclick="calculate()">Результат</button>
    <button onclick="shareResultv()">Поширити</button>
    <button onclick="copyResult()">Скопіювати</button>
    <button onclick="window.history.back()">Меню</button>
</div>

<p id="resultv"></p>

<script>
// Дата за замовчуванням: поточна + 1 день
    var now = new Date();
    var timeZoneOffset = 120; // +02:00 Київ
    var kievTime = new Date(now.getTime() + (timeZoneOffset*60*1000));
    // Додаємо один день
    kievTime.setDate(kievTime.getDate() + 1);
    var formattedDate = kievTime.toISOString().substr(0,10);
    document.getElementById('date').value = formattedDate;
// Підвантаження збережених даних
if(localStorage.getItem('crewNumber')) {
    document.getElementById('crewNumber').value = localStorage.getItem('crewNumber');
}
if(localStorage.getItem('previousFuel')) {
    document.getElementById('previousFuel').value = localStorage.getItem('previousFuel');
}
if(localStorage.getItem('fuelReceived')) {
    document.getElementById('fuelReceived').value = localStorage.getItem('fuelReceived');
}
    if(localStorage.getItem('startSpeedometer')) {
    document.getElementById('startSpeedometer').value = localStorage.getItem('startSpeedometer');
}
if(localStorage.getItem('highwayDistance=0')) {
    document.getElementById('highwayDistance').value = localStorage.getItem('highwayDistance');
}
// if(localStorage.getItem('streetDistance')) {
//    document.getElementById('streetDistance').value = localStorage.getItem('streetDistance');
//}
// if(localStorage.getItem('offroadDistance')) {
//    document.getElementById('offroadDistance').value = localStorage.getItem('offroadDistance');
// р}

// Масив полів і відповідних лейблів для перевірки
const fields = [
    {id: 'crewNumber', label: 'crewLabel'},
    {id: 'previousFuel', label: 'prevFuelLabel'},
    {id: 'fuelReceived', label: 'fuelRecLabel'},
    {id: 'startSpeedometer', label: 'startLabel'},
    {id: 'endSpeedometer', label: 'endLabel'},
    {id: 'highwayDistance', label: 'highwayLabel'},
    {id: 'streetDistance', label: 'streetLabel'},
    {id: 'offroadDistance', label: 'offroadLabel'}
];

function formatDate(inputDate) {
    var dateParts = inputDate.split("-");
    return dateParts[2] + "-" + dateParts[1] + "-" + dateParts[0];
}

function calculate() {
    let allValid = true;

    // Очищаємо старі зірочки
    fields.forEach(f => {
        document.getElementById(f.label).innerHTML = document.getElementById(f.label).innerText.replace(' *', '');
    });

    // Перевірка числових полів та номера екіпажу
    fields.forEach(f => {
        const val = document.getElementById(f.id).value.trim();
        if (val === '' || (f.id !== 'crewNumber' && isNaN(parseFloat(val)))) {
            document.getElementById(f.label).innerHTML += ' <span class="error-star">*</span>';
            allValid = false;
        }
    });

    if (!allValid) {
        alert('Будь ласка, введіть всі числові значення');
        return;
    }

    var date = document.getElementById('date').value;
    var crewNumber = document.getElementById('crewNumber').value;
    var previousFuel = parseFloat(document.getElementById('previousFuel').value);
    var fuelReceived = parseFloat(document.getElementById('fuelReceived').value);
    var startSpeedometer = parseFloat(document.getElementById('startSpeedometer').value);
    var endSpeedometer = parseFloat(document.getElementById('endSpeedometer').value);
    var highwayDistance = parseFloat(document.getElementById('highwayDistance').value);
    var streetDistance = parseFloat(document.getElementById('streetDistance').value);
    var offroadDistance = parseFloat(document.getElementById('offroadDistance').value);

    var difference = endSpeedometer - startSpeedometer;
    var totalDistance = highwayDistance + streetDistance + offroadDistance;

    if (difference !== totalDistance) {
        alert('Різниця спідометра не відповідає сумі відстаней доріг');
        return;
    }

    var highwayFuel = Math.round((highwayDistance / 100) * 15.9 * 1.10);
    var streetFuel = Math.round((streetDistance / 100) * 15.9 * 0.85);
    var offroadFuel = Math.round((offroadDistance / 100) * 15.9 * 1.30);
    var totalFuel = highwayFuel + streetFuel + offroadFuel;

    var remainingFuel = previousFuel - totalFuel + fuelReceived;

    var formattedDate = formatDate(date);
    var resultv = formattedDate + "_№" + crewNumber + "_" + previousFuel + "л_заправка " + fuelReceived + "л_" + endSpeedometer + "_" + difference + "км_колона " + highwayDistance + "км_траса " + streetDistance + "км_бездоріжжя " + offroadDistance + "км_" + totalFuel + "л_" + remainingFuel + "л";

    document.getElementById('resultv').innerText = resultv;

    // Збереження даних
    localStorage.setItem('crewNumber', crewNumber);
    localStorage.setItem('previousFuel', remainingFuel);
    localStorage.setItem('startSpeedometer', endSpeedometer);
    localStorage.setItem('highwayDistance', highwayDistance);
    localStorage.setItem('streetDistance', streetDistance);
    localStorage.setItem('offroadDistance', offroadDistance);
}

function shareResultv() {
    var resultTextv = document.getElementById('resultv').innerText;
    if (navigator.share) {
        navigator.share({text: resultTextv}).catch(err => alert('Помилка: ' + err));
    } else {
        alert('Обмін недоступний на цьому пристрої');
    }
}

function copyResult() {
    var resultTextv = document.getElementById('resultv').innerText;
    if(resultTextv) {
        navigator.clipboard.writeText(resultTextv)
        .then(() => alert('Результат скопійовано'))
        .catch(err => alert('Помилка копіювання: ' + err));
    } else {
        alert('Немає результату для копіювання');
    }
}
</script>
</body>
</html>
